{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Quick Activity Log{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-bolt"></i> Quick Activity Log</h4>
                    <small class="text-muted">Log a completed activity quickly</small>
                </div>
                <div class="card-body">
                    <form method="post" id="quickActivityForm">
                        {% csrf_token %}
                        {% crispy form %}
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('quickActivityForm');
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(form);
        
        fetch(form.action || window.location.pathname, {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Show success message
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-success alert-dismissible fade show';
                alertDiv.innerHTML = `
                    <i class="fas fa-check-circle"></i> Activity logged successfully!
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                form.parentNode.insertBefore(alertDiv, form);
                
                // Reset form
                form.reset();
                
                // Redirect after 2 seconds
                setTimeout(() => {
                    window.location.href = '/sales-monitoring/';
                }, 2000);
            } else {
                // Show error message
                console.error('Form errors:', data.errors);
                // You could display specific field errors here
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
});
</script>
{% endblock %}
